<!DOCTYPE html>
<html lang="pl">
  <head>
    <title>Web Audio API &ndash; AudioContext i OscillatorNode </title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <!-- <link rel="stylesheet" type="text/css" href="css/xxxxxxx.css" /> -->
  </head>

  <body style="padding: 20px;">


    <h1>Web Audio API &ndash; AudioContext i OscillatorNode</h1>

    <p style="margin: 20px;"><strong>Uwaga</strong></p> 
    <p style="margin: 20px; margin-left: 40px;">W tym wariancie aplikacji, po zatrzymaniu oscylatora, da się go ponownie uruchomić dopiero po odświeżeniu strony.
	Zmień kod w funkcji <code>zatrzymOsc()</code>, by można było uruchamiać i zatrzymywać oscylator bez konieczności odświeżania strony. 
	</p>
	<p style="margin: 20px; margin-left: 30px;">Zmodyfikuj graf przepływu dźwięku i dodaj do niego węzły pośrednie, np. <code>GainNode</code>, umożliwiający sterowanie poziomem głośności. 
	</p>
    <button id="button_audio" style="margin: 20px;" onclick="uruchomOsc()">Uruchom oscylator</button>
    <button id="button_wideo" style="margin: 20px;" onclick="zatrzymOsc()">Zatrzymaj oscylator</button>
    
    <div style="margin: 20px;">
      <label for="volume">Głośność: </label>
      <input type="range" id="volume" min="0" max="1" step="0.01" value="0.3" 
             oninput="zmianaGlosnosci(this.value)" />
      <span id="volumeValue">30%</span>
    </div>

    <script>
      const context = new AudioContext();
      let osc = null;
      let gainNode = null;
      let isPlaying = false;

      const initOscillator = () => {
        osc = new OscillatorNode(context);
        gainNode = new GainNode(context);
        gainNode.gain.value = 0.3;
        
        osc.connect(gainNode);
        gainNode.connect(context.destination);
        osc.start();
        isPlaying = true;
      }

      const uruchomOsc = () => {
        if (!isPlaying) {
          initOscillator();
          context.resume();
        }
      }

      const zatrzymOsc = () => {
        if (isPlaying && osc) {
          osc.stop();
          osc.disconnect();
          gainNode.disconnect();
          isPlaying = false;
        }
      }

      const zmianaGlosnosci = (value) => {
        if (gainNode) {
          gainNode.gain.value = value;
        }
        document.getElementById('volumeValue').textContent = Math.round(value * 100) + '%';
      }
    </script>
  </body>
</html>